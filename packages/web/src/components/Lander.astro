---
import { Image } from 'astro:assets';
import { getRelativeLocaleUrl } from 'astro:i18n';
import config from "virtual:starlight/user-config";

import CopyIcon from "../assets/lander/copy.svg";
import CheckIcon from "../assets/lander/check.svg";
import TuiScreenshot from "../assets/lander/screenshot-splash.png";
import VscodeScreenshot from "../assets/lander/screenshot-vscode.png";
import GithubScreenshot from "../assets/lander/screenshot-github.png";

const { data } = Astro.locals.starlightRoute.entry;
const { title = data.title, tagline, image, actions = [] } = data.hero || {};

const imageAttrs = {
    loading: 'eager' as const,
    decoding: 'async' as const,
    width: 400,
    alt: image?.alt || '',
};

const github = (config.social || []).filter(s => s.icon === 'github')[0];
const locale = Astro.currentLocale || 'root';
const t = Astro.locals.t as (key: string) => string;
const docsHref = getRelativeLocaleUrl(locale, "")
const docsCliHref = getRelativeLocaleUrl(locale, "cli")
const docsIdeHref = getRelativeLocaleUrl(locale, "ide")
const docsGithubHref = getRelativeLocaleUrl(locale, "github")

const command = "curl -fsSL"
const protocol = "https://"
const url = "opensploit.ai/install"
const bash = "| bash"

let darkImage: ImageMetadata | undefined;
let lightImage: ImageMetadata | undefined;
let rawHtml: string | undefined;
if (image) {
    if ('file' in image) {
        darkImage = image.file;
    } else if ('dark' in image) {
        darkImage = image.dark;
        lightImage = image.light;
    } else {
        rawHtml = image.html;
  }
}

const faqItems = [
  { q: "What is OpenSploit?", a: "OpenSploit is an AI-powered autonomous penetration testing agent, built on OpenCode. It orchestrates 25+ security tools through intelligent automation, guiding you through reconnaissance, enumeration, exploitation, and reporting phases." },
  { q: "How does it work?", a: "You describe your target and objectives in natural language. OpenSploit's AI agent selects appropriate tools, executes them in Docker containers, analyzes results, and adapts its strategy based on findings." },
  { q: "Do I need security expertise?", a: "OpenSploit lowers the barrier to security testing, but understanding the basics helps. It's designed for security practitioners, developers learning security, and students in cybersecurity programs." },
  { q: "What tools are included?", a: "25+ tools including nmap (scanning), sqlmap (SQL injection), ffuf (fuzzing), hydra (brute force), nuclei (vulnerability scanning), metasploit (exploitation), and more. Tools download on-demand when first used." },
  { q: "Is it legal to use?", a: "OpenSploit is for authorized security testing only. You must have explicit written permission to test any target. Unauthorized testing is illegal. The tool includes safeguards against scanning forbidden targets." },
  { q: "Does it support local LLMs?", a: "Yes. OpenSploit supports 75+ LLM providers including Ollama for fully local, offline operation. You can also use Claude, GPT, Gemini, or any compatible API." },
  { q: "How much does it cost?", a: "OpenSploit is free and open source. You only pay for LLM API usage if you choose a cloud provider. Local models via Ollama are completely free." },
  { q: "Is it open source?", a: "Yes. OpenSploit is a fork of OpenCode â€” MIT licensed and available on GitHub. Contributions are welcome." },
];
---
<div class="hero">
    <section class="top">
      <div class="logo">
        {darkImage && (
          <Image
            src={darkImage}
            {...imageAttrs}
            class:list={{ 'light:sl-hidden': Boolean(lightImage) }}
          />
        )}
        {lightImage && <Image src={lightImage} {...imageAttrs} class="dark:sl-hidden" />}
      </div>
      <h1>{t('app.lander.hero.title')}</h1>
      <p class="subtitle">AI-powered penetration testing. Free models included or connect any provider including Claude, GPT, Gemini, and local models via Ollama.</p>
    </section>

    <section class="cta">
      <div class="col1">
        <a href={docsHref}>{t('app.lander.cta.getStarted')}</a>
      </div>
      <div class="col2">
      <button class="command" data-command={`${command} ${protocol}${url} ${bash}`}>
          <code>
            <span>{command}&nbsp;</span><span class="protocol">{protocol}</span><span class="highlight">{url}</span>&nbsp;{bash}
          </code>
          <span class="copy">
            <CopyIcon />
            <CheckIcon />
          </span>
        </button>
      </div>
    </section>

    <section class="metrics">
      <div><strong>MIT</strong><span>Open Source</span></div>
      <div><strong>25+</strong><span>Security Tools</span></div>
      <div><strong>75+</strong><span>LLM Providers</span></div>
      <div><strong>5</strong><span>Attack Phases</span></div>
    </section>

    <section class="content">
      <h2>What is OpenSploit?</h2>
      <ul>
        <li><b>{t('app.lander.features.phases.title')}</b>: {t('app.lander.features.phases.description')}</li>
        <li><b>{t('app.lander.features.tools.title')}</b>: {t('app.lander.features.tools.description')}</li>
        <li><b>{t('app.lander.features.discovery.title')}</b>: {t('app.lander.features.discovery.description')}</li>
        <li><b>{t('app.lander.features.local.title')}</b>: {t('app.lander.features.local.description')}</li>
        <li><b>{t('app.lander.features.containers.title')}</b>: {t('app.lander.features.containers.description')}</li>
        <li><b>{t('app.lander.features.use_any_model.title')}</b>: {t('app.lander.features.use_any_model.prefix')} <a href="https://models.dev">Models.dev</a>, {t('app.lander.features.use_any_model.suffix')}</li>
      </ul>
    </section>

    <section class="alternatives">
      <div class="col1">
        <h3>npm</h3>
        <button class="command" data-command="npm install -g opensploit">
          <code>
            <span>npm install -g</span> <span class="highlight">opensploit</span>
          </code>
          <span class="copy">
            <CopyIcon />
            <CheckIcon />
          </span>
        </button>
      </div>
      <div class="col2">
        <h3>Bun</h3>
        <button class="command" data-command="bun install -g opensploit">
          <code>
            <span>bun install -g</span> <span class="highlight">opensploit</span>
          </code>
          <span class="copy">
            <CopyIcon />
            <CheckIcon />
          </span>
        </button>
      </div>
      <div class="col3">
        <h3>Homebrew</h3>
        <button class="command" data-command="brew install silicon-works/tap/opensploit">
          <code>
            <span>brew install</span> <span class="highlight">silicon-works/tap/opensploit</span>
          </code>
          <span class="copy">
            <CopyIcon />
            <CheckIcon />
          </span>
        </button>
      </div>
      <div class="col4">
        <h3>Paru</h3>
        <button class="command" data-command="paru -S opensploit-bin">
          <code>
            <span>paru -S</span> <span class="highlight">opensploit-bin</span>
          </code>
          <span class="copy">
            <CopyIcon />
            <CheckIcon />
          </span>
        </button>
      </div>
      <div class="col4">
        <h3>Mise</h3>
        <button class="command" data-command="mise use -g github:silicon-works/opensploit">
          <code>
            <span>mise use -g</span> <span class="highlight">github:silicon-works/opensploit</span>
          </code>
          <span class="copy">
            <CopyIcon />
            <CheckIcon />
          </span>
        </button>
      </div>
    </section>

    <section class="images">
      <div class="left">
        <figure>
          <figcaption>{t('app.lander.images.tui.caption')}</figcaption>
          <a href={docsCliHref}>
            <Image src={TuiScreenshot} alt={t('app.lander.images.tui.alt')} />
          </a>
        </figure>
      </div>
      <div class="right">
        <div class="row1">
          <figure>
            <figcaption>{t('app.lander.images.vscode.caption')}</figcaption>
            <a href={docsIdeHref}>
              <Image src={VscodeScreenshot} alt={t('app.lander.images.vscode.alt')} />
            </a>
          </figure>
        </div>
        <div class="row2">
          <figure>
            <figcaption>{t('app.lander.images.github.caption')}</figcaption>
            <a href={docsGithubHref}>
              <Image src={GithubScreenshot} alt={t('app.lander.images.github.alt')} />
            </a>
          </figure>
        </div>
      </div>
    </section>

    <section class="privacy">
      <h2>Privacy First</h2>
      <p>OpenSploit runs entirely on your machine. Your targets, findings, and session data never leave your system unless you explicitly choose to share them. No telemetry, no cloud dependencies for core functionality.</p>
    </section>

    <section class="faq">
      <h2>Frequently Asked Questions</h2>
      {faqItems.map((item) => (
        <details>
          <summary>{item.q}</summary>
          <p>{item.a}</p>
        </details>
      ))}
    </section>

    <section class="disclaimer">
      <p><strong>Authorized Use Only:</strong> OpenSploit is designed for authorized security testing. You must have explicit written permission before testing any system. Unauthorized access to computer systems is illegal. By using OpenSploit, you agree to use it responsibly and in compliance with all applicable laws.</p>
    </section>

    <section class="footer">
      <div class="col1">
        {github && <a href={github.href} target="_blank" rel="noopener noreferrer">GitHub</a>}
        <a href={docsHref}>Docs</a>
      </div>
      <div class="col2">
        <span>&copy; 2026 Silicon Works Ltd</span>
      </div>
    </section>
</div>

<style>
.hero {
  --padding: 3rem;
  --vertical-padding: 1.5rem;
  --heading-font-size: var(--sl-text-3xl);

  margin: 1rem;
  border: 2px solid var(--sl-color-border);
}
@media (max-width: 30rem) {
  .hero {
    --padding: 1rem;
    --vertical-padding: 0.75rem;
    --heading-font-size: var(--sl-text-2xl);

    margin: 0.5rem;
  }
}

section.top {
  padding: var(--padding);

  h1 {
    margin-top: calc(var(--vertical-padding) / 8);
    font-size: var(--heading-font-size);
    line-height: 1.25;
    text-transform: uppercase;
  }

  .subtitle {
    margin-top: 0.75rem;
    color: var(--sl-color-text-secondary);
    font-size: 1rem;
    line-height: 1.6;
    max-width: 42rem;
  }

  img {
    height: auto;
    width: clamp(200px, 70vw, 400px);
  }
}

section.cta {
  display: flex;
  flex-direction: row;
  justify-content: flex-start;
  align-items: stretch;
  border-top: 2px solid var(--sl-color-border);

  @media (max-width: 50rem) {
    flex-direction: column;
  }

  & > div {
    line-height: 1.4;
    padding: var(--vertical-padding) var(--padding);

    a {
      font-size: 1rem;
    }
  }
  & > div.col1 {
    flex: 0 0 auto;
    text-align: center;
    text-transform: uppercase;

    @media (max-width: 50rem) {
      padding-bottom: calc(var(--vertical-padding) + 4px);
    }
  }
  & > div.col2 {
    flex: 1;
    padding-left: 1rem;
    padding-right: 1rem;
  }

  & > div + div {
    border-left: 2px solid var(--sl-color-border);

    @media (max-width: 50rem) {
      border-left: none;
      border-top: 2px solid var(--sl-color-border);
    }
  }

  .command {
    all: unset;
    display: flex;
    align-items: center;
    gap: 0.625rem;
    justify-content: center;
    cursor: pointer;
    width: 100%;

    code {
      color: var(--sl-color-text-secondary);
      font-size: 1.125rem;

      @media (max-width: 24rem) {
        font-size: 0.875rem;
      }
      @media (max-width: 30rem) {
        span.protocol {
          display: none;
        }
      }
      @media (max-width: 43rem) {
        text-align: center;
        span:first-child {
          display: block;
        }
      }
    }
    code .highlight {
      color: var(--sl-color-text);
      font-weight: 500;
    }

    .copy {
      line-height: 1;
      padding: 0;
      @media (max-width: 43rem) {
        display: none;
      }
    }
    .copy svg {
      width: 1rem;
      height: 1rem;
      vertical-align: middle;
    }
    .copy svg:first-child {
      color: var(--sl-color-text-dimmed);
    }
    .copy svg:last-child {
      color: var(--sl-color-text);
      display: none;
    }
    &.success .copy {
      pointer-events: none;
    }
    &.success .copy svg:first-child {
      display: none;
    }
    &.success .copy svg:last-child {
      display: inline;
    }
  }
}

section.metrics {
  border-top: 2px solid var(--sl-color-border);
  display: grid;
  grid-template-columns: repeat(4, 1fr);

  @media (max-width: 30rem) {
    grid-template-columns: repeat(2, 1fr);
  }

  & > div {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: var(--vertical-padding) 0.5rem;
    text-align: center;

    strong {
      font-size: 1.5rem;
      font-weight: 600;
    }

    span {
      font-size: 0.8125rem;
      color: var(--sl-color-text-dimmed);
      text-transform: uppercase;
    }
  }

  & > div + div {
    border-left: 2px solid var(--sl-color-border);
  }

  @media (max-width: 30rem) {
    & > div:nth-child(3) {
      border-left: none;
      border-top: 2px solid var(--sl-color-border);
    }
    & > div:nth-child(4) {
      border-top: 2px solid var(--sl-color-border);
    }
  }
}

section.content {
  border-top: 2px solid var(--sl-color-border);
  padding: var(--padding);

  h2 {
    font-size: 1rem;
    font-weight: 500;
    text-transform: uppercase;
    margin-bottom: 1rem;
  }

  ul {
    padding-left: 1rem;

    li + li {
      margin-top: calc(var(--vertical-padding) / 2);
    }

    li b {
      text-transform: uppercase;
    }
  }
}

section.images {
  --images-height: 600px;
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-template-rows: var(--images-height);
  border-top: 2px solid var(--sl-color-border);

  & > div.left {
    display: flex;
    grid-row: 1;
    grid-column: 1;
  }

  & > div.right {
    display: grid;
    grid-template-rows: 1fr 1fr;
    grid-row: 1;
    grid-column: 2;
    border-left: 2px solid var(--sl-color-border);

    & > div.row1 {
      display: flex;
      grid-row: 1;
      border-bottom: 2px solid var(--sl-color-border);
      height: calc(var(--images-height) / 2);
    }

    & > div.row2 {
      display: flex;
      grid-row: 2;
      height: calc(var(--images-height) / 2);
    }
  }

  figure {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: calc(var(--padding) / 4);
    padding: calc(var(--padding) / 2);
    border-width: 0;
    border-style: solid;
    border-color: var(--sl-color-border);
    min-height: 0;
    overflow: hidden;

    & > div, figcaption {
      display: flex;
      align-items: center;
    }

    & > div {
      flex: 1;
      min-height: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    a {
      display: flex;
      flex: 1;
      min-height: 0;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
    }

    figcaption {
      letter-spacing: -0.03125rem;
      text-transform: uppercase;
      color: var(--sl-color-text-dimmed);
      flex-shrink: 0;

      @media (max-width: 30rem) {
        font-size: 0.75rem;
      }
    }
  }

  & > div.left figure {
    height: var(--images-height);
    box-sizing: border-box;
  }

  & > div.right figure {
    height: calc(var(--images-height) / 2);
    box-sizing: border-box;
  }

  & > div.left img {
    width: 100%;
    height: 100%;
    min-width: 0;
    object-fit: contain;
  }

  & > div.right img {
    width: 100%;
    height: calc(100% - 2rem);
    object-fit: contain;
    display: block;
  }

  @media (max-width: 30rem) {
    & {
      --images-height: auto;
      grid-template-columns: 1fr;
      grid-template-rows: auto auto;
    }

    & > div.left {
      grid-row: 1;
      grid-column: 1;
    }

    & > div.right {
      grid-row: 2;
      grid-column: 1;
      border-left: none;
      border-top: 2px solid var(--sl-color-border);

      & > div.row1,
      & > div.row2 {
        height: auto;
      }
    }

    & > div.left figure,
    & > div.right figure {
      height: auto;
    }

    & > div.left img,
    & > div.right img {
      width: 100%;
      height: auto;
      max-height: none;
    }
  }
}

section.alternatives {
  border-top: 2px solid var(--sl-color-border);
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-template-rows: 1fr 1fr;

  @media (max-width: 40rem) {
    grid-template-columns: 1fr;
    grid-template-rows: auto;
  }

  & > div {
    display: flex;
    flex-direction: column;
    padding: calc(var(--vertical-padding) / 2) calc(var(--padding) / 2) calc(var(--vertical-padding) / 2 + 0.125rem);
    text-align: left;
    gap: 0.5rem;

    @media (max-width: 30rem) {
      gap: 0.3125rem;
    }

    @media (max-width: 40rem) {
      text-align: left;
    }
  }

  & > div.col1 {
    border-bottom: 2px solid var(--sl-color-border);

    @media (max-width: 40rem) {
      border-bottom: none;
    }
  }

  & > div.col2 {
    border-left: 2px solid var(--sl-color-border);
    border-bottom: 2px solid var(--sl-color-border);

    @media (max-width: 40rem) {
      border-left: none;
      border-bottom: none;
      border-top: 2px solid var(--sl-color-border);
    }
  }

  & > div.col3 {
    @media (max-width: 40rem) {
      border-top: 2px solid var(--sl-color-border);
    }
  }

  & > div.col4 {
    border-left: 2px solid var(--sl-color-border);
    @media (max-width: 40rem) {
      border-left: none;
      border-top: 2px solid var(--sl-color-border);
    }
  }

  h3 {
    letter-spacing: -0.03125rem;
    text-transform: uppercase;
    color: var(--sl-color-text-dimmed);
    font-weight: normal;
    font-size: 1rem;
    flex-shrink: 0;

    @media (max-width: 30rem) {
      font-size: 0.75rem;
    }
  }

  .command {
    all: unset;
    display: flex;
    align-items: center;
    gap: 0.625rem;
    justify-content: flex-start;
    cursor: pointer;
    width: 100%;

    @media (max-width: 40rem) {
      justify-content: flex-start;
    }

    @media (max-width: 30rem) {
      justify-content: center;
    }

    code {
      color: var(--sl-color-text-secondary);
      font-size: 1rem;

      @media (max-width: 24rem) {
        font-size: 0.875rem;
      }
    }

    code .highlight {
      color: var(--sl-color-text);
      font-weight: 500;
    }

    .copy {
      line-height: 1;
      padding: 0;

      @media (max-width: 40rem) {
        display: none;
      }
    }

    .copy svg {
      width: 1rem;
      height: 1rem;
      vertical-align: middle;
    }

    .copy svg:first-child {
      color: var(--sl-color-text-dimmed);
    }

    .copy svg:last-child {
      color: var(--sl-color-text);
      display: none;
    }

    &.success .copy {
      pointer-events: none;
    }

    &.success .copy svg:first-child {
      display: none;
    }

    &.success .copy svg:last-child {
      display: inline;
    }
  }
}

section.privacy {
  border-top: 2px solid var(--sl-color-border);
  padding: var(--padding);

  h2 {
    font-size: 1rem;
    font-weight: 500;
    text-transform: uppercase;
    margin-bottom: 0.75rem;
  }

  p {
    color: var(--sl-color-text-secondary);
    line-height: 1.6;
  }
}

section.faq {
  border-top: 2px solid var(--sl-color-border);
  padding: var(--padding);

  h2 {
    font-size: 1rem;
    font-weight: 500;
    text-transform: uppercase;
    margin-bottom: 1rem;
  }

  details {
    border-top: 1px solid var(--sl-color-border);

    &:last-child {
      border-bottom: 1px solid var(--sl-color-border);
    }

    summary {
      cursor: pointer;
      padding: 0.75rem 0;
      font-weight: 500;
      list-style: none;
      display: flex;
      justify-content: space-between;
      align-items: center;

      &::after {
        content: "+";
        font-size: 1.25rem;
        color: var(--sl-color-text-dimmed);
        transition: transform 0.2s;
      }

      &::-webkit-details-marker {
        display: none;
      }
    }

    &[open] summary::after {
      content: "\2212";
    }

    p {
      padding: 0 0 0.75rem;
      color: var(--sl-color-text-secondary);
      line-height: 1.6;
    }
  }
}

section.disclaimer {
  border-top: 2px solid var(--sl-color-border);
  padding: calc(var(--padding) / 2) var(--padding);
  background: var(--sl-color-bg-nav);

  p {
    font-size: 0.75rem;
    color: var(--sl-color-text-dimmed);
    line-height: 1.5;
  }
}

section.footer {
  border-top: 2px solid var(--sl-color-border);
  display: flex;
  flex-direction: row;

  & > div {
    flex: 1;
    text-align: center;
    text-transform: uppercase;
    padding: var(--vertical-padding) 0.5rem;
  }

  & > div.col1 {
    display: flex;
    gap: 1.5rem;
    justify-content: center;
  }

  & > div + div {
    border-left: 2px solid var(--sl-color-border);
  }

  @media (max-width: 30rem) {
    flex-wrap: wrap;

    & > div.col1 {
      flex: 1;
    }

    & > div.col2 {
      flex: 1;
    }
  }
}
</style>

<style is:global>
:root[data-has-hero] {
  header.header {
    display: none;
  }
  .main-frame {
    padding-top: 0;

    .main-pane > main {
      padding: 0;
    }
  }
  main > .content-panel .sl-markdown-content {
    margin-top: 0;
  }
}
</style>

<script>
  const buttons = document.querySelectorAll("button.command") as NodeListOf<HTMLButtonElement>

  buttons.forEach(button => {
    button.addEventListener("click", () => {
      navigator.clipboard.writeText(button.dataset.command!)
      button.classList.toggle("success")
      setTimeout(() => {
        button.classList.toggle("success");
      }, 1500)
    })
  })
</script>
