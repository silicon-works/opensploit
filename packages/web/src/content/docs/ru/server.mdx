---
title: Сервер
description: Взаимодействуйте с сервером открытого кода через HTTP.
---

import config from "../../../../config.mjs"
export const typesUrl = `${config.github}/blob/dev/packages/sdk/js/src/gen/types.gen.ts`

Команда `opencode serve` запускает автономный HTTP-сервер, который предоставляет конечную точку OpenAPI, которую может использовать клиент с открытым кодом.

---

### Использование

```bash
opencode serve [--port <number>] [--hostname <string>] [--cors <origin>]
```

#### Параметры

| Флаг  | Описание                                       | По умолчанию |
| ----- | ---------------------------------------------- | ------------ |
| ХХ0ГГ | Порт для прослушивания                         | `4096`       |
| ХХ0ГГ | Имя хоста для прослушивания                    | `127.0.0.1`  |
| ХХ0ГГ | Включить обнаружение mDNS                      | ХХ0ГГ        |
| ХХ0ГГ | Пользовательское доменное имя для службы mDNS  | ХХ0ГГ        |
| ХХ0ГГ | Дополнительные источники браузера, позволяющие | `[]`         |

`--cors` можно передать несколько раз:

```bash
opencode serve --cors http://localhost:5173 --cors https://app.example.com
```

---

### Аутентификация

Установите `OPENCODE_SERVER_PASSWORD`, чтобы защитить сервер с помощью базовой аутентификации HTTP. Имя пользователя по умолчанию — `opencode` или установите `OPENCODE_SERVER_USERNAME`, чтобы переопределить его. Это относится как к `opencode serve`, так и к `opencode web`.

```bash
OPENCODE_SERVER_PASSWORD=your-password opencode serve
```

---

### Как это работает

Когда вы запускаете `opencode`, он запускает TUI и сервер. Где находится TUI
клиент, который общается с сервером. Сервер предоставляет спецификацию OpenAPI 3.1.
конечная точка. Эта конечная точка также используется для создания файла [SDK](/docs/sdk).

:::кончик
Используйте сервер открытого кода для программного взаимодействия с открытым кодом.
:::

Эта архитектура позволяет открытому коду поддерживать несколько клиентов и позволяет программно взаимодействовать с открытым кодом.

Вы можете запустить `opencode serve`, чтобы запустить автономный сервер. Если у вас есть
TUI с открытым кодом запущен, `opencode serve` запустит новый сервер.

---

#### Подключиться к существующему серверу

Когда вы запускаете TUI, он случайным образом назначает порт и имя хоста. Вместо этого вы можете передать `--hostname` и `--port` [flags](/docs/cli). Затем используйте это для подключения к его серверу.

Конечную точку [`/tui`](#tui) можно использовать для управления TUI через сервер. Например, вы можете предварительно заполнить или запустить подсказку. Эта настройка используется плагинами OpenCode [IDE](/docs/ide).

---

## Спецификация

Сервер публикует спецификацию OpenAPI 3.1, которую можно просмотреть по адресу:

```
http://<hostname>:<port>/doc
```

Например, ХХ0ГГ. Используйте спецификацию для создания клиентов или проверки типов запросов и ответов. Или просмотрите его в обозревателе Swagger.

---

## API

Сервер открытого кода предоставляет следующие API.

---

### Глобальный

| Метод | Путь  | Описание                                         | Ответ              |
| ----- | ----- | ------------------------------------------------ | ------------------ |
| ХХ0ГГ | ХХ0ГГ | Получить информацию о состоянии и версии сервера | ХХ0ГГ              |
| ХХ0ГГ | ХХ0ГГ | Получить глобальные события (поток SSE)          | Трансляция событий |

---

### Проект

| Метод | Путь  | Описание                | Ответ                                        |
| ----- | ----- | ----------------------- | -------------------------------------------- |
| ХХ0ГГ | ХХ0ГГ | Список всех проектов    | <a href={typesUrl}><code>Проект[]</code></a> |
| ХХ0ГГ | ХХ0ГГ | Получить текущий проект | <a href={typesUrl}><code>Проект</code></a>   |

---

### Путь и система контроля версий

| Метод | Путь  | Описание                                     | Ответ                                       |
| ----- | ----- | -------------------------------------------- | ------------------------------------------- |
| ХХ0ГГ | ХХ0ГГ | Получить текущий путь                        | <a href={typesUrl}><code>Путь</code></a>    |
| ХХ0ГГ | ХХ0ГГ | Получить информацию VCS для текущего проекта | <a href={typesUrl}><code>VcsInfo</code></a> |

---

### Пример

| Метод | Путь  | Описание                  | Ответ |
| ----- | ----- | ------------------------- | ----- |
| ХХ0ГГ | ХХ0ГГ | Удалить текущий экземпляр | ХХ0ГГ |

---

### Конфигурация

| Метод | Путь  | Описание                                  | Ответ                                                                                    |
| ----- | ----- | ----------------------------------------- | ---------------------------------------------------------------------------------------- |
| ХХ0ГГ | ХХ0ГГ | Получить информацию о конфигурации        | <a href={typesUrl}><code>Config</code></a>                                               |
| ХХ0ГГ | ХХ0ГГ | Обновить конфигурацию                     | <a href={typesUrl}><code>Config</code></a>                                               |
| ХХ0ГГ | ХХ0ГГ | Список поставщиков и моделей по умолчанию | `{ providers: `<a href={typesUrl}>Provider[]</a>`, default: { [key: string]: string } }` |

---

### Поставщик

| Метод | Путь  | Описание                                        | Ответ                                                                               |
| ----- | ----- | ----------------------------------------------- | ----------------------------------------------------------------------------------- |
| ХХ0ГГ | ХХ0ГГ | Список всех поставщиков                         | `{ all: `<a href={typesUrl}>Provider[]</a>`, default: {...}, connected: string[] }` |
| ХХ0ГГ | ХХ0ГГ | Получить методы аутентификации поставщика       | `{ [providerID: string]: `<a href={typesUrl}>ProviderAuthMethod[]</a>` }`           |
| ХХ0ГГ | ХХ0ГГ | Авторизуйте провайдера с помощью OAuth          | <a href={typesUrl}><code>ProviderAuthAuthorization</code></a>                       |
| ХХ0ГГ | ХХ0ГГ | Обработка обратного вызова OAuth для провайдера | ХХ0ГГ                                                                               |

---

### Сессии

| Метод | Путь  | Описание                                           | Примечания                                                                            |
| ----- | ----- | -------------------------------------------------- | ------------------------------------------------------------------------------------- |
| ХХ0ГГ | ХХ0ГГ | Список всех сессий                                 | Возвращает <a href={typesUrl}><code>Session[]</code></a>                              |
| ХХ0ГГ | ХХ0ГГ | Создать новый сеанс                                | тело: `{ parentID?, title? }`, возвращает <a href={typesUrl}><code>Session</code></a> |
| ХХ0ГГ | ХХ0ГГ | Получить статус сеанса для всех сеансов            | Возвращает `{ [sessionID: string]: `<a href={typesUrl}>SessionStatus</a>` }`          |
| ХХ0ГГ | ХХ0ГГ | Получить подробную информацию о сеансе             | Возвращает <a href={typesUrl}><code>Session</code></a>                                |
| ХХ0ГГ | ХХ0ГГ | Удалить сеанс и все его данные                     | Возвращает `boolean`                                                                  |
| ХХ0ГГ | ХХ0ГГ | Обновить свойства сеанса                           | тело: `{ title? }`, возвращает <a href={typesUrl}><code>Session</code></a>            |
| ХХ0ГГ | ХХ0ГГ | Получить дочерние сеансы сеанса                    | Возвращает <a href={typesUrl}><code>Session[]</code></a>                              |
| ХХ0ГГ | ХХ0ГГ | Получить список дел для сеанса                     | Возвращает <a href={typesUrl}><code>Todo[]</code></a>                                 |
| ХХ0ГГ | ХХ0ГГ | Проанализируйте приложение и создайте `AGENTS.md`. | тело: `{ messageID, providerID, modelID }`, возвращает `boolean`                      |
| ХХ0ГГ | ХХ0ГГ | Разветвить существующий сеанс по сообщению         | тело: `{ messageID? }`, возвращает <a href={typesUrl}><code>Session</code></a>        |
| ХХ0ГГ | ХХ0ГГ | Прервать текущий сеанс                             | Возвращает `boolean`                                                                  |
| ХХ0ГГ | ХХ0ГГ | Поделиться сеансом                                 | Возвращает <a href={typesUrl}><code>Session</code></a>                                |
| ХХ0ГГ | ХХ0ГГ | Отменить общий доступ к сеансу                     | Возвращает <a href={typesUrl}><code>Session</code></a>                                |
| ХХ0ГГ | ХХ0ГГ | Получить разницу для этой сессии                   | запрос: `messageID?`, возвращает <a href={typesUrl}><code>FileDiff[]</code></a>       |
| ХХ0ГГ | ХХ0ГГ | Подведите итоги сессии                             | тело: `{ providerID, modelID }`, возвращает `boolean`                                 |
| ХХ0ГГ | ХХ0ГГ | Отменить сообщение                                 | тело: `{ messageID, partID? }`, возвращает `boolean`                                  |
| ХХ0ГГ | ХХ0ГГ | Восстановить все восстановленные сообщения         | Возвращает `boolean`                                                                  |
| ХХ0ГГ | ХХ0ГГ | Ответ на запрос разрешения                         | тело: `{ response, remember? }`, возвращает `boolean`                                 |

---

### Сообщения

| Метод | Путь  | Описание                                      | Примечания                                                                                                                                                               |
| ----- | ----- | --------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| ХХ0ГГ | ХХ0ГГ | Список сообщений в сеансе                     | запрос: `limit?`, возвращает `{ info: `<a href={typesUrl}>Message</a>`, parts: `<a href={typesUrl}>Part[]</a>`}[]`                                                       |
| ХХ0ГГ | ХХ0ГГ | Отправьте сообщение и дождитесь ответа        | тело: `{ messageID?, model?, agent?, noReply?, system?, tools?, parts }`, возвращает `{ info: `<a href={typesUrl}>Message</a>`, parts: `<a href={typesUrl}>Part[]</a>`}` |
| ХХ0ГГ | ХХ0ГГ | Получить подробную информацию о сообщении     | Возвращает `{ info: `<a href={typesUrl}>Message</a>`, parts: `<a href={typesUrl}>Part[]</a>`}`                                                                           |
| ХХ0ГГ | ХХ0ГГ | Отправить сообщение асинхронно (без ожидания) | тело: то же, что и `/session/:id/message`, возвращает `204 No Content`.                                                                                                  |
| ХХ0ГГ | ХХ0ГГ | Выполнить команду косой черты                 | тело: `{ messageID?, agent?, model?, command, arguments }`, возвращает `{ info: `<a href={typesUrl}>Message</a>`, parts: `<a href={typesUrl}>Part[]</a>`}`               |
| ХХ0ГГ | ХХ0ГГ | Запустите команду оболочки                    | тело: `{ agent, model?, command }`, возвращает `{ info: `<a href={typesUrl}>Message</a>`, parts: `<a href={typesUrl}>Part[]</a>`}`                                       |

---

### Команды

| Метод | Путь  | Описание           | Ответ                                         |
| ----- | ----- | ------------------ | --------------------------------------------- |
| ХХ0ГГ | ХХ0ГГ | Список всех команд | <a href={typesUrl}><code>Команда[]</code></a> |

---

### Файлы

| Метод | Путь  | Описание                             | Ответ                                                                                         |
| ----- | ----- | ------------------------------------ | --------------------------------------------------------------------------------------------- |
| ХХ0ГГ | ХХ0ГГ | Поиск текста в файлах                | Массив объектов соответствия `path`, `lines`, `line_number`, `absolute_offset`, `submatches`. |
| ХХ0ГГ | ХХ0ГГ | Поиск файлов и каталогов по имени    | `string[]` (пути)                                                                             |
| ХХ0ГГ | ХХ0ГГ | Найдите символы рабочей области      | <a href={typesUrl}><code>Символ[]</code></a>                                                  |
| ХХ0ГГ | ХХ0ГГ | Список файлов и каталогов            | <a href={typesUrl}><code>FileNode[]</code></a>                                                |
| ХХ0ГГ | ХХ0ГГ | Чтение файла                         | <a href={typesUrl}><code>FileContent</code></a>                                               |
| ХХ0ГГ | ХХ0ГГ | Получить статус отслеживаемых файлов | <a href={typesUrl}><code>Файл[]</code></a>                                                    |

#### `/find/file` параметры запроса

- `query` (обязательно) — строка поиска (нечеткое совпадение)
- `type` (необязательно) — ограничить результаты `"file"` или `"directory"`.
- `directory` (необязательно) — переопределить корень проекта для поиска.
- `limit` (необязательно) — максимальное количество результатов (1–200)
- `dirs` (необязательно) — устаревший флаг (`"false"` возвращает только файлы)

---

### Инструменты (Экспериментальные)

| Метод | Путь  | Описание                                       | Ответ                                        |
| ----- | ----- | ---------------------------------------------- | -------------------------------------------- |
| ХХ0ГГ | ХХ0ГГ | Список всех идентификаторов инструментов       | <a href={typesUrl}><code>ToolIDs</code></a>  |
| ХХ0ГГ | ХХ0ГГ | Список инструментов со схемами JSON для модели | <a href={typesUrl}><code>ToolList</code></a> |

---

### LSP, форматтеры и MCP

| Метод | Путь  | Описание                            | Ответ                                                     |
| ----- | ----- | ----------------------------------- | --------------------------------------------------------- |
| ХХ0ГГ | ХХ0ГГ | Получить статус LSP-сервера         | <a href={typesUrl}><code>LSPStatus[]</code></a>           |
| ХХ0ГГ | ХХ0ГГ | Получить статус форматтера          | <a href={typesUrl}><code>FormatterStatus[]</code></a>     |
| ХХ0ГГ | ХХ0ГГ | Получить статус сервера MCP         | `{ [name: string]: `<a href={typesUrl}>MCPStatus</a>` }`  |
| ХХ0ГГ | ХХ0ГГ | Динамическое добавление сервера MCP | тело: `{ name, config }`, возвращает объект состояния MCP |

---

### Агенты

| Метод | Путь  | Описание                      | Ответ                                       |
| ----- | ----- | ----------------------------- | ------------------------------------------- |
| ХХ0ГГ | ХХ0ГГ | Список всех доступных агентов | <a href={typesUrl}><code>Агент[]</code></a> |

---

### Ведение журнала

| Метод | Путь  | Описание                                                               | Ответ |
| ----- | ----- | ---------------------------------------------------------------------- | ----- |
| ХХ0ГГ | ХХ0ГГ | Напишите запись в журнале. Тело: `{ service, level, message, extra? }` | ХХ0ГГ |

---

### ТУИ

| Метод | Путь  | Описание                                       | Ответ                     |
| ----- | ----- | ---------------------------------------------- | ------------------------- |
| ХХ0ГГ | ХХ0ГГ | Добавить текст в приглашение                   | ХХ0ГГ                     |
| ХХ0ГГ | ХХ0ГГ | Открыть диалоговое окно справки                | ХХ0ГГ                     |
| ХХ0ГГ | ХХ0ГГ | Откройте селектор сеансов                      | ХХ0ГГ                     |
| ХХ0ГГ | ХХ0ГГ | Откройте выбор темы                            | ХХ0ГГ                     |
| ХХ0ГГ | ХХ0ГГ | Откройте выбор модели                          | ХХ0ГГ                     |
| ХХ0ГГ | ХХ0ГГ | Отправить текущий запрос                       | ХХ0ГГ                     |
| ХХ0ГГ | ХХ0ГГ | Очистить подсказку                             | ХХ0ГГ                     |
| ХХ0ГГ | ХХ0ГГ | Выполнить команду (`{ command }`)              | ХХ0ГГ                     |
| ХХ0ГГ | ХХ0ГГ | Показать тост (`{ title?, message, variant }`) | ХХ0ГГ                     |
| ХХ0ГГ | ХХ0ГГ | Дождитесь следующего запроса на управление     | Объект запроса управления |
| ХХ0ГГ | ХХ0ГГ | Ответ на запрос управления (`{ body }`)        | ХХ0ГГ                     |

---

### Авторизация

| Метод | Путь  | Описание                                                                                    | Ответ |
| ----- | ----- | ------------------------------------------------------------------------------------------- | ----- |
| ХХ0ГГ | ХХ0ГГ | Установите учетные данные для аутентификации. Тело должно соответствовать схеме поставщика. | ХХ0ГГ |

---

### События

| Метод | Путь  | Описание                                                                                       | Ответ                                |
| ----- | ----- | ---------------------------------------------------------------------------------------------- | ------------------------------------ |
| ХХ0ГГ | ХХ0ГГ | Поток событий, отправленный сервером. Первое событие — `server.connected`, затем события шины. | Поток событий, отправленных сервером |

---

### Документы

| Метод | Путь  | Описание                 | Ответ                                  |
| ----- | ----- | ------------------------ | -------------------------------------- |
| ХХ0ГГ | ХХ0ГГ | Спецификация OpenAPI 3.1 | HTML-страница со спецификацией OpenAPI |
