---
title: ЛСП Серверы
description: OpenCode интегрируется с вашими серверами LSP.
---

OpenCode интегрируется с вашим протоколом языкового сервера (LSP), чтобы помочь LLM взаимодействовать с вашей кодовой базой. Он использует диагностику для предоставления обратной связи LLM.

---

## Встроенный

OpenCode поставляется с несколькими встроенными LSP-серверами для популярных языков:

| ЛСП Сервер            | Расширения                                                          | Требования                                                              |
| --------------------- | ------------------------------------------------------------------- | ----------------------------------------------------------------------- |
| астро                 | .astro                                                              | Автоматическая установка для проектов Astro                             |
| бить                  | .sh, .bash, .zsh, .ksh                                              | Автоматически устанавливает сервер языка bash                           |
| лязг                  | .c, .cpp, .cc, .cxx, .c++, .h, .hpp, .hh, .hxx, .h++                | Автоматическая установка для проектов C/C++.                            |
| csharp                | .cs                                                                 | `.NET SDK` установлен                                                   |
| Clojure-LSP           | .clj, .cljs, .cljc, .edn                                            | Доступна команда `clojure-lsp`                                          |
| дротик                | .dart                                                               | Доступна команда `dart`                                                 |
| дено                  | .ts, .tsx, .js, .jsx, .mjs                                          | Доступна команда `deno` (автоматически определяет deno.json/deno.jsonc) |
| эликсир-ls            | .ex, .exs                                                           | Доступна команда `elixir`                                               |
| эслинт                | .ts, .tsx, .js, .jsx, .mjs, .cjs, .mts, .cts, .vue                  | Зависимость `eslint` в проекте                                          |
| fsharp                | .fs, .fsi, .fsx, .fsscript                                          | `.NET SDK` установлен                                                   |
| светиться             | .блеск                                                              | Доступна команда `gleam`                                                |
| гоплс                 | .идти                                                               | Доступна команда `go`                                                   |
| хлс                   | .hs, .lhs                                                           | Доступна команда `haskell-language-server-wrapper`                      |
| jdtls                 | .java                                                               | `Java SDK (version 21+)` установлен                                     |
| Котлин-LS             | .кт, .ктс                                                           | Автоматическая установка для проектов Kotlin                            |
| Луа-ЛС                | .lua                                                                | Автоматическая установка для проектов Lua                               |
| снег                  | .nix                                                                | Доступна команда `nixd`                                                 |
| ocaml-lsp             | .мл, .мли                                                           | Доступна команда `ocamllsp`                                             |
| бычья линта           | .ts, .tsx, .js, .jsx, .mjs, .cjs, .mts, .cts, .vue, .astro, .svelte | Зависимость `oxlint` в проекте                                          |
| PHP                   | .php                                                                | Автоматическая установка для проектов PHP                               |
| призма                | .prisma                                                             | Доступна команда `prisma`                                               |
| пирит                 | .py, .pyi                                                           | Установлена ​​зависимость `pyright`                                     |
| рубин-lsp (рубокоп)   | .rb, .rake, .gemspec, .ru                                           | Доступны команды `ruby` и `gem`.                                        |
| ржавчина              | .rs                                                                 | Доступна команда `rust-analyzer`                                        |
| исходный комплект-lsp | .swift, .objc, .objcpp                                              | `swift` установлен (`xcode` в macOS)                                    |
| стройный              | .стройный                                                           | Автоматическая установка для проектов Svelte                            |
| терраформировать      | .tf, .tfvars                                                        | Автоматическая установка из выпусков GitHub                             |
| tinymist              | .тип, .типк                                                         | Автоматическая установка из выпусков GitHub                             |
| машинопись            | .ts, .tsx, .js, .jsx, .mjs, .cjs, .mts, .cts                        | Зависимость `typescript` в проекте                                      |
| вид                   | .vue                                                                | Автоматическая установка для проектов Vue                               |
| Ямл-лс                | .yaml, .yml                                                         | Автоматически устанавливает Red Hat yaml-language-server                |
| Злс                   | .zig, .zon                                                          | Доступна команда `zig`                                                  |

Серверы LSP автоматически включаются при обнаружении одного из указанных выше расширений файлов и выполнении требований.

:::примечание
Вы можете отключить автоматическую загрузку LSP-сервера, установив для переменной среды `OPENCODE_DISABLE_LSP_DOWNLOAD` значение `true`.
:::

---

## Как это работает

Когда opencode открывает файл, он:

1. Проверяет расширение файла на всех включенных серверах LSP.
2. Запускает соответствующий сервер LSP, если он еще не запущен.

---

## Настроить

Вы можете настроить серверы LSP через раздел `lsp` в конфигурации открытого кода.

```json title="opencode.json"
{
  "$schema": "https://opencode.ai/config.json",
  "lsp": {}
}
```

Каждый LSP-сервер поддерживает следующее:

| Свойство         | Тип                 | Описание                                                                    |
| ---------------- | ------------------- | --------------------------------------------------------------------------- |
| `disabled`       | логическое значение | Установите для этого параметра значение `true`, чтобы отключить сервер LSP. |
| `command`        | нить[]              | Команда запуска LSP-сервера                                                 |
| `extensions`     | нить[]              | Расширения файлов, которые должен обрабатывать этот сервер LSP              |
| `env`            | объект              | Переменные среды, которые нужно установить при запуске сервера              |
| `initialization` | объект              | Параметры инициализации для отправки на сервер LSP                          |

Давайте посмотрим на несколько примеров.

---

### Переменные среды

Используйте свойство `env` для установки переменных среды при запуске сервера LSP:

```json title="opencode.json" {5-7}
{
  "$schema": "https://opencode.ai/config.json",
  "lsp": {
    "rust": {
      "env": {
        "RUST_LOG": "debug"
      }
    }
  }
}
```

---

### Параметры инициализации

Используйте свойство `initialization` для передачи параметров инициализации на LSP-сервер. Это настройки, специфичные для сервера, отправляемые во время запроса LSP `initialize`:

```json title="opencode.json" {5-9}
{
  "$schema": "https://opencode.ai/config.json",
  "lsp": {
    "typescript": {
      "initialization": {
        "preferences": {
          "importModuleSpecifierPreference": "relative"
        }
      }
    }
  }
}
```

:::примечание
Параметры инициализации зависят от сервера LSP. Проверьте документацию вашего LSP-сервера на наличие доступных опций.
:::

---

### Отключение LSP-серверов

Чтобы отключить **все** LSP-серверы глобально, установите для `lsp` значение `false`:

```json title="opencode.json" {3}
{
  "$schema": "https://opencode.ai/config.json",
  "lsp": false
}
```

Чтобы отключить **конкретный** LSP-сервер, установите для `disabled` значение `true`:

```json title="opencode.json" {5}
{
  "$schema": "https://opencode.ai/config.json",
  "lsp": {
    "typescript": {
      "disabled": true
    }
  }
}
```

---

### Пользовательские LSP-серверы

Вы можете добавить собственные LSP-серверы, указав команду и расширения файлов:

```json title="opencode.json" {4-7}
{
  "$schema": "https://opencode.ai/config.json",
  "lsp": {
    "custom-lsp": {
      "command": ["custom-lsp-server", "--stdio"],
      "extensions": [".custom"]
    }
  }
}
```

---

## Дополнительная информация

### PHP Intelephense

PHP Intelephense предлагает дополнительные функции через лицензионный ключ. Вы можете предоставить лицензионный ключ, поместив (только) ключ в текстовый файл по адресу:

- В macOS/Linux: `$HOME/intelephense/licence.txt`
- В Windows: `%USERPROFILE%/intelephense/licence.txt`

Файл должен содержать только лицензионный ключ без какого-либо дополнительного содержимого.
