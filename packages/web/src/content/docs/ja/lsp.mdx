---
title: LSPサーバー
description: OpenCode は LSP サーバーと統合します。
---

OpenCode は言語サーバー プロトコル (LSP) と統合して、LLM がコードベースと対話できるようにします。診断を使用して LLM にフィードバックを提供します。

---

## 内蔵

OpenCode には、一般的な言語用のいくつかの組み込み LSP サーバーが付属しています。

| LSPサーバー           | 拡張機能                                                            | 要件                                                        |
| --------------------- | ------------------------------------------------------------------- | ----------------------------------------------------------- |
| アストロ              | .astro                                                              | Astro プロジェクトの自動インストール                        |
| バッシュ              | .sh、.bash、.zsh、.ksh                                              | bash-lang-server を自動インストールします。                 |
| クランド              | .c、.cpp、.cc、.cxx、.c++、.h、.hpp、.hh、.hxx、.h++                | C/C++ プロジェクトの自動インストール                        |
| シーシャープ          | .cs                                                                 | `.NET SDK` がインストールされました                         |
| clojure-lsp           | .clj、.cljs、.cljc、.edn                                            | `clojure-lsp` コマンドが利用可能                            |
| ダーツ                | .ダーツ                                                             | `dart` コマンドが利用可能                                   |
| デノ                  | .ts、.tsx、.js、.jsx、.mjs                                          | `deno` コマンドが利用可能 (deno.json/deno.jsonc を自動検出) |
| エリクサーLS          | .ex、.exs                                                           | `elixir` コマンドが利用可能                                 |
| エスリント            | .ts、.tsx、.js、.jsx、.mjs、.cjs、.mts、.cts、.vue                  | プロジェクト内の `eslint` 依存関係                          |
| フシャープ            | .fs、.fsi、.fsx、.fsscript                                          | `.NET SDK` がインストールされました                         |
| 輝く.gleam            | `gleam` コマンドが利用可能                                          |
| ゴップル              | .go                                                                 | `go` コマンドが利用可能                                     |
| HLS                   | .hs、.lhs                                                           | `haskell-language-server-wrapper` コマンドが利用可能        |
| jdtls                 | .java                                                               | `Java SDK (version 21+)` がインストールされました           |
| kotlin-ls             | .kt、.kts                                                           | Kotlin プロジェクトの自動インストール                       |
| ルアール              | .lua                                                                | Lua プロジェクトの自動インストール                          |
| ニクスド              | .nix                                                                | `nixd` コマンドが利用可能                                   |
| ocaml-lsp             | .ml、.mli                                                           | `ocamllsp` コマンドが利用可能                               |
| オックスリント        | .ts、.tsx、.js、.jsx、.mjs、.cjs、.mts、.cts、.vue、.astro、.svelte | プロジェクト内の `oxlint` 依存関係                          |
| php インテルフェンス  | .php                                                                | PHP プロジェクトの自動インストール                          |
| プリズマ              | .プリズム                                                           | `prisma` コマンドが利用可能                                 |
| 著作権                | .py、.pyi                                                           | `pyright` 依存関係がインストールされました                  |
| Ruby-LSP (ルボコップ) | .rb、.rake、.gemspec、.ru                                           | `ruby` および `gem` コマンドが利用可能                      |
| さび                  | .rs                                                                 | `rust-analyzer` コマンドが利用可能                          |
| ソースキット-lsp      | .swift、.objc、.objcpp                                              | `swift` がインストールされています (macOS では `xcode`)。   |
| 細い                  | .svelte                                                             | Svelte プロジェクトの自動インストール                       |
| テラフォーム          | .tf、.tfvars                                                        | GitHub リリースからの自動インストール                       |
| タイニーミスト        | .typ、.typc                                                         | GitHub リリースからの自動インストール                       |
| タイプスクリプト      | .ts、.tsx、.js、.jsx、.mjs、.cjs、.mts、.cts                        | プロジェクト内の `typescript` 依存関係                      |
| ビュー                | .vue                                                                | Vue プロジェクトの自動インストール                          |
| yaml-ls               | .yaml、.yml                                                         | Red Hat yaml-lang-server を自動インストールします。         |
| zls                   | .zig、.zon                                                          | `zig` コマンドが利用可能                                    |

上記のファイル拡張子のいずれかが検出され、要件が満たされると、LSP サーバーは自動的に有効になります。

:::注記
`OPENCODE_DISABLE_LSP_DOWNLOAD` 環境変数を `true` に設定すると、LSP サーバーの自動ダウンロードを無効にできます。
:::

---

## 仕組み

opencode がファイルを開くと、次のようになります。

1. 有効なすべての LSP サーバーに対してファイル拡張子をチェックします。
2. 適切な LSP サーバーがまだ実行されていない場合は開始します。

---

## 設定する

Opencode 構成の `lsp` セクションを通じて LSP サーバーをカスタマイズできます。

```json title="opencode.json"
{
  "$schema": "https://opencode.ai/config.json",
  "lsp": {}
}
```

各 LSP サーバーは以下をサポートします。

| プロパティ       | タイプ       | 説明                                                       |
| ---------------- | ------------ | ---------------------------------------------------------- |
| `disabled`       | ブール値     | LSP サーバーを無効にするには、これを `true` に設定します。 |
| `command`        | 文字列[]     | LSP サーバーを起動するコマンド                             |
| `extensions`     | 文字列[]     | この LSP サーバーが処理するファイル拡張子                  |
| `env`            | オブジェクト | サーバーの起動時に設定する環境変数                         |
| `initialization` | オブジェクト | LSP サーバーに送信する初期化オプション                     |

いくつかの例を見てみましょう。

---

### 環境変数

LSP サーバーの起動時に `env` プロパティを使用して環境変数を設定します。

```json title="opencode.json" {5-7}
{
  "$schema": "https://opencode.ai/config.json",
  "lsp": {
    "rust": {
      "env": {
        "RUST_LOG": "debug"
      }
    }
  }
}
```

---

### 初期化オプション

`initialization` プロパティを使用して、初期化オプションを LSP サーバーに渡します。これらは、LSP `initialize` リクエスト中に送信されるサーバー固有の設定です。

```json title="opencode.json" {5-9}
{
  "$schema": "https://opencode.ai/config.json",
  "lsp": {
    "typescript": {
      "initialization": {
        "preferences": {
          "importModuleSpecifierPreference": "relative"
        }
      }
    }
  }
}
```

:::注記
初期化オプションは LSP サーバーによって異なります。利用可能なオプションについては、LSP サーバーのドキュメントを確認してください。
:::

---

### LSPサーバーの無効化

**すべて** LSP サーバーをグローバルに無効にするには、`lsp` を `false` に設定します。

```json title="opencode.json" {3}
{
  "$schema": "https://opencode.ai/config.json",
  "lsp": false
}
```

**特定** LSP サーバーを無効にするには、`disabled` を `true` に設定します。

```json title="opencode.json" {5}
{
  "$schema": "https://opencode.ai/config.json",
  "lsp": {
    "typescript": {
      "disabled": true
    }
  }
}
```

---

### カスタムLSPサーバー

コマンドとファイル拡張子を指定して、カスタム LSP サーバーを追加できます。

```json title="opencode.json" {4-7}
{
  "$schema": "https://opencode.ai/config.json",
  "lsp": {
    "custom-lsp": {
      "command": ["custom-lsp-server", "--stdio"],
      "extensions": [".custom"]
    }
  }
}
```

---

## 追加情報

### PHP インテリフェンス

PHP Intelephense は、ライセンス キーを通じてプレミアム機能を提供します。ライセンス キーを指定するには、次の場所にあるテキスト ファイルにキー (のみ) を配置します。

- macOS/Linux の場合: `$HOME/intelephense/licence.txt`
- Windows の場合: `%USERPROFILE%/intelephense/licence.txt`

ファイルにはライセンス キーのみが含まれており、追加のコンテンツは含まれていません。
